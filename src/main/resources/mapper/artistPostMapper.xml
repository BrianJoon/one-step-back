<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.app.onestepback.mapper.ArtistPostMapper">
    <select id="selectCountOfPost" resultType="int">
        SELECT COUNT(MEMBER_ID)
        FROM VIEW_ARTIST_POST
        WHERE MEMBER_ID = #{memberId}
    </select>

    <select id="select3Posts" resultType="artistPostDTO">
        SELECT *
        FROM (SELECT A.ID,
                     A.MEMBER_ID,
                     A.POST_TITLE,
                     A.POST_SUBTITLE,
                     A.POST_CONTENT,
                     A.POST_CATEGORY,
                     A.POST_VIEW_COUNT,
                     A.POST_WRITE_TIME,
                     A.POST_UPDATE_TIME,
                     M.MEMBER_NICKNAME,
                     M.MEMBER_KAKAO_PROFILE_URL,
                     M.MEMBER_PROFILE_NAME,
                     M.MEMBER_PROFILE_PATH,
                     (SELECT COUNT(L.POST_ID)
                      FROM TBL_POST_LIKE L
                      WHERE L.POST_ID = A.ID)                                                AS LIKE_COUNT,
                     (SELECT COUNT(R.POST_ID) FROM TBL_POST_REPLY R WHERE R.POST_ID = A.ID)  AS REPLY_COUNT,
                     (SELECT F.FILE_NAME
                      FROM TBL_POST_FILE F
                      WHERE F.POST_ID = A.ID
                        AND F.ID = (SELECT MIN(ID) FROM TBL_POST_FILE WHERE POST_ID = A.ID)) AS FILE_NAME,
                     (SELECT F.FILE_PATH
                      FROM TBL_POST_FILE F
                      WHERE F.POST_ID = A.ID
                        AND F.ID = (SELECT MIN(ID) FROM TBL_POST_FILE WHERE POST_ID = A.ID)) AS FILE_PATH
              FROM VIEW_ARTIST_POST A
                       JOIN TBL_MEMBER M ON A.MEMBER_ID = M.ID
              WHERE MEMBER_ID = #{memberId}
              ORDER BY POST_WRITE_TIME DESC)
        WHERE ROWNUM &lt;= 3
    </select>

    <select id="selectAll" resultType="artistPostDTO">
        SELECT P2.ID, P2.MEMBER_ID, P2.POST_TITLE, P2.POST_SUBTITLE, P2.POST_CONTENT, P2.POST_VIEW_COUNT, P2.POST_IMG_NAME, P2.POST_IMG_PATH, P2.POST_WRITE_TIME, P2.MEMBER_NICKNAME, P2.MEMBER_KAKAO_PROFILE_URL, P2.MEMBER_PROFILE_NAME, P2.MEMBER_PROFILE_PATH, P2.LIKE_COUNT FROM
        (
            SELECT ROWNUM R, P1.ID, P1.MEMBER_ID, P1.POST_TITLE, P1.POST_SUBTITLE, P1.POST_CONTENT, P1.POST_VIEW_COUNT, P1.POST_IMG_NAME, P1.POST_IMG_PATH, P1.POST_WRITE_TIME, P1.MEMBER_NICKNAME, P1.MEMBER_KAKAO_PROFILE_URL, P1.MEMBER_PROFILE_NAME, P1.MEMBER_PROFILE_PATH, P1.LIKE_COUNT FROM
            (
                SELECT P.ID, P.MEMBER_ID, P.POST_TITLE, P.POST_SUBTITLE, P.POST_CONTENT, P.POST_VIEW_COUNT, P.POST_IMG_NAME, P.POST_IMG_PATH, P.POST_WRITE_TIME, M.MEMBER_NICKNAME, M.MEMBER_KAKAO_PROFILE_URL, M.MEMBER_PROFILE_NAME, M.MEMBER_PROFILE_PATH,
                (
                    SELECT COUNT(L.ARTIST_POST_ID)
                    FROM TBL_LIKE_ARTIST_POST L
                    WHERE L.ARTIST_POST_ID = P.ID
                ) AS LIKE_COUNT
                FROM TBL_ARTIST_POST P
                JOIN TBL_MEMBER M ON P.MEMBER_ID = M.ID
                WHERE P.MEMBER_ID = #{memberId}
                ORDER BY P.POST_WRITE_TIME DESC
            ) P1
            WHERE ROWNUM &lt;= #{pagination.endRow}
            ) P2
        WHERE P2.R >= #{pagination.startRow}
    </select>
</mapper>